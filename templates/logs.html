{% extends "base.html" %}
{% block content %}
  <h5 class="mb-2">{{ t('nav.logs') }}</h5>
  <div class="row g-3">
    <div class="col-12 col-lg-5">
      <div class="card h-100">
        <div class="card-body p-0">
          <div class="table-responsive" style="max-height: 70vh;">
            <table class="table table-dark table-hover table-sm align-middle mb-0">
              <thead class="sticky-top bg-dark">
                <tr>
                  <th>{{ t('logs.file') }}</th>
                  <th>{{ t('logs.size') }}</th>
                  <th>{{ t('logs.date') }}</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% for f in files %}
                <tr class="{% if f.path == path %}table-active{% endif %}">
                  <td class="small text-break" title="{{ f.path }}">{{ f.path }}</td>
                  <td class="small text-nowrap">{{ f.size|bytes_human }}</td>
                  <td class="small text-nowrap">{{ f.mtime|int }}</td>
                  <td class="text-end">
                    <form method="post">
                      <input type="hidden" name="path" value="{{ f.path }}">
                      <button class="btn btn-sm btn-outline-primary py-0 px-1"><i class="bi bi-eye"></i></button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-7">
      {% if content is not none %}
        <div class="card h-100">
          <div class="card-header py-2 d-flex justify-content-between align-items-center">
            <span class="small monospace text-truncate">{{ path }}</span>
            <span class="badge bg-secondary">{{ t('logs.last_lines') }}</span>
          </div>
          <div class="card-body p-0">
            <pre class="monospace m-0 p-2" style="max-height: 70vh; overflow: auto;">{{ content }}</pre>
          </div>
        </div>
      {% else %}
        <div class="alert alert-info">{{ t('logs.select_msg') }}</div>
      {% endif %}
    </div>
  </div>
  <script>
    // Format timestamps locally
    document.querySelectorAll('td:nth-child(3)').forEach(td => {
      const ts = parseInt(td.innerText);
      if(!isNaN(ts)) {
        td.innerText = new Date(ts * 1000).toLocaleString();
      }
    });
  </script>
{% endblock %}
